<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fruit Fista ‚Äì Nearby Shops</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
body { background: linear-gradient(135deg, #fceabb, #f8b500); overflow: hidden; }

.app-header {
    background: linear-gradient(90deg, #ff6b6b, #feca57);
    color: white;
    padding: 20px;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    position: relative;
    z-index: 2;
}

.floating-fruit { position: absolute; width: 50px; animation: float 6s ease-in-out infinite; z-index: 1; pointer-events: none; }
@keyframes float { 0% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-15px) rotate(10deg); } 100% { transform: translateY(0px) rotate(0deg); } }
.fruit1 { top: 10%; left: 5%; animation-delay: 0s; }
.fruit2 { top: 15%; right: 10%; animation-delay: 1s; }
.fruit3 { top: 25%; left: 30%; animation-delay: 2s; }
.fruit4 { top: 40%; right: 5%; animation-delay: 3s; }
.fruit5 { bottom: 10%; left: 10%; animation-delay: 1.5s; }
.fruit6 { bottom: 15%; right: 20%; animation-delay: 2.5s; }
.fruit7 { top: 60%; left: 5%; animation-delay: 0.5s; }
.fruit8 { bottom: 30%; left: 60%; animation-delay: 1s; }
.fruit9 { top: 70%; right: 35%; animation-delay: 2s; }
.fruit10 { bottom: 5%; right: 60%; animation-delay: 3.5s; }

#map { width: 90%; height: 50vh; margin: 20px auto; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); }

.shop-search { width: 90%; margin: 20px auto; }
.shop-search input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc; }

.shop-list {
    background: rgba(255,255,255,0.95);
    width: 90%;
    margin: 0 auto 20px auto;
    padding: 15px;
    height: 40vh;
    overflow-y: auto;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}
.shop-list h3 { margin-bottom: 10px; font-size: 20px; color: #333; }
.shop-list ul { list-style: none; }
.shop-list li { padding: 12px; margin-bottom: 10px; border-radius: 10px; background: #fff3e0; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.2s; }
.shop-list li:hover { transform: scale(1.02); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
.shop-name { font-weight: bold; font-size: 16px; color: #ff6b6b; }
.shop-distance { font-size: 13px; color: #555; margin-top: 2px; }
.shop-fruits { font-size: 13px; color: #555; margin-top: 5px; }

#adminBtn { position: fixed; bottom: 20px; right: 20px; padding: 15px 20px; border-radius: 50px; border: none; color: #fff; font-size: 16px; cursor: pointer; z-index: 1000; background: #ff6b6b; }

.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 2000; }
.modal-content { background: #fff; width: 90%; max-width: 400px; margin: 50px auto; padding: 20px; border-radius: 15px; max-height: 90vh; overflow-y: auto; }
.modal-content input { width: 100%; padding: 8px; margin: 5px 0; }
.fruit-row { display: flex; gap: 5px; margin-bottom: 5px; }
.fruit-row input { flex: 1; }
.add-fruit-btn { width: 100%; margin: 5px 0; padding: 8px; background: #1dd1a1; color: white; border: none; cursor: pointer; border-radius: 5px; }
</style>
</head>
<body>

<!-- Floating fruits -->
<img src="https://img.icons8.com/color/96/apple.png" class="floating-fruit fruit1" alt="apple">
<img src="https://img.icons8.com/color/96/banana.png" class="floating-fruit fruit2" alt="banana">
<img src="https://img.icons8.com/color/96/strawberry.png" class="floating-fruit fruit3" alt="strawberry">
<img src="https://img.icons8.com/color/96/pineapple.png" class="floating-fruit fruit4" alt="pineapple">
<img src="https://img.icons8.com/color/96/grapes.png" class="floating-fruit fruit5" alt="grapes">
<img src="https://img.icons8.com/color/96/cherry.png" class="floating-fruit fruit6" alt="cherry">
<img src="https://img.icons8.com/color/96/watermelon.png" class="floating-fruit fruit7" alt="watermelon">
<img src="https://img.icons8.com/color/96/orange.png" class="floating-fruit fruit8" alt="orange">
<img src="https://img.icons8.com/color/96/kiwi.png" class="floating-fruit fruit9" alt="kiwi">
<img src="https://img.icons8.com/color/96/mango.png" class="floating-fruit fruit10" alt="mango">

<header class="app-header">üçé Nearby Fruit Shops</header>

<div id="map"></div>

<!-- Search box -->
<div class="shop-search">
    <input id="searchInput" type="text" placeholder="Search by fruit or area...">
</div>

<div class="shop-list">
    <h3>Nearby Shops</h3>
    <ul id="shops">
        <li>Loading nearby fruit shops...</li>
    </ul>
</div>

<button id="adminBtn">üõ† Admin</button>

<div id="adminPanel" class="modal">
    <div class="modal-content">
        <h3>Add Shop</h3>
        <input id="shopName" placeholder="Shop Name">
        <input id="shopLat" placeholder="Latitude" type="number" step="any">
        <input id="shopLng" placeholder="Longitude" type="number" step="any">
        <input id="shopVicinity" placeholder="Area / Vicinity">

        <div id="fruitContainer">
            <h4>Fruits and Prices</h4>
        </div>
        <button type="button" class="add-fruit-btn" onclick="addFruitRow()">‚ûï Add Fruit</button>

        <button onclick="saveShop()" style="width:100%; margin-top:10px; background:#ff6b6b; color:#fff; padding:10px;">Save</button>
        <button onclick="closeAdmin()" style="width:100%; margin-top:5px;">Cancel</button>
    </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const defaultLocation = [11.0168, 76.9558];

let sampleShops = [
    { name: "Coimbatore Fruit Market", vicinity: "R S Puram, Coimbatore", location: [11.0170, 76.9600], fruits: [{name:"Apple", price:"50"}, {name:"Banana", price:"20"}] },
    { name: "Fresh Fruits Coimbatore", vicinity: "Gandhipuram, Coimbatore", location: [11.0190, 76.9550], fruits: [{name:"Orange", price:"30"}] },
];

const map = L.map('map').setView(defaultLocation, 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
        const userLoc = [pos.coords.latitude, pos.coords.longitude];
        L.marker(userLoc).addTo(map).bindPopup("You are here").openPopup();
        map.setView(userLoc, 13);
    });
} else {
    L.marker(defaultLocation).addTo(map).bindPopup("Coimbatore").openPopup();
}

const shopList = document.getElementById("shops");

function renderShops(shops = sampleShops) {
    shopList.innerHTML = "";
    map.eachLayer(layer => {
        if(layer instanceof L.Marker && !layer._popup._content.includes("You are here") && !layer._popup._content.includes("Coimbatore")){
            map.removeLayer(layer);
        }
    });

    shops.forEach(shop => {
        let fruitHTML = "<ul>";
        shop.fruits.forEach(f => fruitHTML += `<li>${f.name} - ‚Çπ${f.price}</li>`);
        fruitHTML += "</ul>";

        L.marker(shop.location).addTo(map).bindPopup(`<b>${shop.name}</b><br>${shop.vicinity}<br>${fruitHTML}`);

        const li = document.createElement("li");
        li.innerHTML = `<div class="shop-name">${shop.name}</div>
                        <div class="shop-distance">${shop.vicinity}</div>
                        <div class="shop-fruits">Fruits: ${fruitHTML}</div>`;
        shopList.appendChild(li);
    });
}

renderShops();

// Admin panel
const adminBtn = document.getElementById("adminBtn");
const adminPanel = document.getElementById("adminPanel");
adminBtn.onclick = ()=>{ adminPanel.style.display = "block"; };
function closeAdmin(){ adminPanel.style.display = "none"; }

// Dynamic fruit input
function addFruitRow(name='', price='') {
    const container = document.getElementById("fruitContainer");
    const row = document.createElement("div");
    row.className = "fruit-row";
    row.innerHTML = `<input placeholder="Fruit Name" value="${name}"><input placeholder="Price" value="${price}">`;
    container.appendChild(row);
}

// Initialize with one fruit row
addFruitRow();

function saveShop() {
    const name = document.getElementById("shopName").value;
    const lat = parseFloat(document.getElementById("shopLat").value);
    const lng = parseFloat(document.getElementById("shopLng").value);
    const vicinity = document.getElementById("shopVicinity").value;

    const fruitRows = document.querySelectorAll("#fruitContainer .fruit-row");
    const fruits = [];
    fruitRows.forEach(row => {
        const inputs = row.querySelectorAll("input");
        const fName = inputs[0].value.trim();
        const fPrice = inputs[1].value.trim();
        if(fName && fPrice) fruits.push({name:fName, price:fPrice});
    });

    if(name && !isNaN(lat) && !isNaN(lng) && vicinity && fruits.length){
        sampleShops.push({name, location:[lat,lng], vicinity, fruits});
        renderShops();
        closeAdmin();
        document.getElementById("shopName").value='';
        document.getElementById("shopLat").value='';
        document.getElementById("shopLng").value='';
        document.getElementById("shopVicinity").value='';
        document.getElementById("fruitContainer").innerHTML='';
        addFruitRow();
    } else {
        alert("Please fill all fields and add at least one fruit with price.");
    }
}

// Search functionality
const searchInput = document.getElementById("searchInput");
searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase();
    const filteredShops = sampleShops.filter(shop => {
        const fruitMatch = shop.fruits.some(f => f.name.toLowerCase().includes(query));
        const areaMatch = shop.vicinity.toLowerCase().includes(query);
        return fruitMatch || areaMatch;
    });
    renderShops(filteredShops);
});
</script>

</body>
</html>
